<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Dev Radar</title>

		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	</head>
	<body>
		<header>
			<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
				<div class="container">
					<a class="navbar-brand" href="/">
						<img src="/logo.png" width="30" height="30" class="d-inline-block align-top" alt="logo"> Dev Radar</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarSupportedContent">
						<ul class="navbar-nav me-auto mb-2 mb-lg-0">
							<li class="nav-item">
								<a class="nav-link active" aria-current="page" href="/">Home</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" aria-current="page" href="/topics">Topics</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>
		<main class="container">
			<article class="card mt-2">
	<div class="card-header">
		<h1 class="mb-0">Patching GCC to Build Actually Portable Executables</h1>
		<div>
			<small>2023/07/14</small>
		</div>

	</div>
	<div class="card-body">
		<div class="disclaimer">
			This article was written by an AI ðŸ¤–. The original article can be found <a href="https://ahgamut.github.io/2023/07/13/patching-gcc-cosmo/" target="_blank"> here</a>.
		</div>
		<p>In this article, the author discusses a patch they wrote for GCC to simplify building Actually Portable Executables with Cosmopolitan Libc. This patch allows developers to build popular software such as bash, curl, git, ninja, and even GCC itself with Cosmopolitan Libc without having to change the source code. The built executables can run on various operating systems including Linux, FreeBSD, MacOS, OpenBSD, NetBSD, and in some cases, even Windows. The author provides instructions on how to port your own software to Cosmopolitan Libc using the patch. They also explain the motivation behind the patch and how it fits into the conventional build systems like ./configure and cmake. The article concludes by discussing the process of porting software to Cosmopolitan Libc and the benefits of the GCC patch in simplifying this process.</p>
<p>Introduction</p>
<p>The article begins by mentioning that Lua was the first programming language to be ported to Cosmopolitan Libc, followed by Wren, Janet, and Fabrice Bellard's quickjs. The author highlights a common change that had to be made across these ports, which involved rewriting switch statements with system values like SIGTERM or EINVAL as if statements. They raised an issue on Github about this and received a response explaining the need for this change. The author then shares their experience of writing ports and realizing that the switch(errno) pattern is common and automating the bending of rules would speed up the software porting process.</p>
<p>Switch to If</p>
<p>The article dives into the technical details of the switch(errno) pattern and how it can be a challenge when porting software. According to the C standard, case labels need to be compile-time constants. If EINVAL is not a compile-time constant, an error would occur when compiling the code snippet with GCC. To overcome this, the author introduces their solution of automatically bending the rules by converting switch statements to if statements. They provide a code snippet to illustrate this approach.</p>
<p>Conclusion</p>
<p>In this article, the author presents a GCC patch that simplifies building Actually Portable Executables with Cosmopolitan Libc. They explain the process of porting software to Cosmopolitan Libc and how the patch fits into conventional build systems. The author also discusses the challenges faced when dealing with switch statements and their solution of automatically converting them to if statements. This patch is a significant step towards seamlessly building a wide range of software with Cosmopolitan Libc, making it easier for developers to leverage its benefits.</p>
	</div>
</article>

		</main>
		<footer class="footer mt-auto py-3 bg-dark">
			<div class="container">
				<span class="text-muted">2023 | dev-radar</span>
			</div>
		</footer>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="/styles.css"/>
	</body>

</html>